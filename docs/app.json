[{"name":"app.R","content":"library(shiny)\n\n# =========================================\n# Preload all CSVs from app/data into a list\n# =========================================\n\ndata_files <- list.files(\"app/data\", pattern = \"\\\\.csv$\", full.names = TRUE)\n\ndata_list <- list()\nif (length(data_files) > 0) {\n  data_list <- lapply(data_files, read.csv)\n  names(data_list) <- sub(\"\\\\.csv$\", \"\", basename(data_files))\n}\n\n# =========================================\n# Simple help text for supported functions\n# =========================================\n\nhelp_texts <- list(\n  hist = \"\nhist(x, breaks = ...)\n\nCreates a histogram of a numeric vector x.\n- x: numeric data (e.g. data$height)\n- breaks: number of bins (or a vector of break points)\n\nExample:\n  hist(survey$height, breaks = 10)\n\",\n  qnorm = \"\nqnorm(p, mean = 0, sd = 1)\n\nGives the quantile (cutoff) of a Normal(mean, sd) distribution.\n- p: probability (e.g. 0.975 for a 97.5% cutoff)\n- mean, sd: mean and standard deviation\n\nExample:\n  qnorm(0.975)       # z* for a 95% CI\n\",\n  t_test = \"\nt.test(x, y = NULL, mu = 0, conf.level = 0.95)\n\nPerforms a t-test.\n- One-sample: t.test(x, mu = mean_under_H0)\n- Two-sample: t.test(x ~ group, data = ...)\n\nExample:\n  t.test(survey$height, mu = 170)\n\",\n  plot = \"\nplot(y ~ x, data = ...)\n\nCreates a scatterplot of y versus x from a data frame.\n- x: numeric predictor\n- y: numeric response\n\nExample:\n  plot(height ~ weight, data = survey)\n\"\n)\n\nui <- fluidPage(\n  titlePanel(\"Intro Stats: Interactive R Code Helper\"),\n\n  sidebarLayout(\n    sidebarPanel(\n      tabsetPanel(\n        id = \"helper_tabs\",\n\n        # ---- Data tab: choose dataset and see preview ----\n        tabPanel(\n          \"Data\",\n          uiOutput(\"data_ui\"),\n          br(),\n          h5(\"Preview of selected dataset:\"),\n          tableOutput(\"data_preview\")\n        ),\n\n        # ---- Graphics tab: histogram & scatterplot ----\n        tabPanel(\n          \"Graphics\",\n          uiOutput(\"graphics_ui\")\n        )\n\n        # Later you can add:\n        # tabPanel(\"Statistics\", ...)\n      )\n    ),\n\n    mainPanel(\n      h4(\"R code (you can edit this):\"),\n      textAreaInput(\n        \"code\",\n        label = NULL,\n        value = \"x <- rnorm(10)\\nmean(x)\\nsd(x)\",\n        rows = 10,\n        width = \"100%\"\n      ),\n      br(),\n      actionButton(\"run\", \"Run code\"),\n      hr(),\n      h4(\"Text / numeric output:\"),\n      verbatimTextOutput(\"text_out\"),\n      h4(\"Plot output:\"),\n      plotOutput(\"plot_out\", height = \"300px\"),\n      hr(),\n      h4(\"Function help:\"),\n      verbatimTextOutput(\"fun_help\")\n    )\n  )\n)\n\nserver <- function(input, output, session) {\n\n  # Environment that persists across runs in this browser session\n  user_env <- new.env(parent = globalenv())\n\n  # Put all preloaded datasets into the user environment\n  if (length(data_list) > 0) {\n    for (nm in names(data_list)) {\n      assign(nm, data_list[[nm]], envir = user_env)\n    }\n  }\n\n  # Reactive value for which function's help to show\n  current_fun <- reactiveVal(NULL)\n\n  # =====================\n  # Data tab\n  # =====================\n\n  output$data_ui <- renderUI({\n    if (length(data_list) == 0) {\n      return(helpText(\"No CSV files found in 'app/data'.\"))\n    }\n\n    tagList(\n      selectInput(\n        \"dataset_name\",\n        \"Choose a dataset (preloaded from app/data):\",\n        choices = names(data_list)\n      )\n    )\n  })\n\n  output$data_preview <- renderTable({\n    req(input$dataset_name)\n    df <- data_list[[input$dataset_name]]\n    head(df)\n  }, rownames = TRUE)\n\n  # =====================\n  # Graphics tab\n  # =====================\n\n  output$graphics_ui <- renderUI({\n    if (length(data_list) == 0) {\n      return(helpText(\"No CSV files found in 'app/data'.\"))\n    }\n\n    tagList(\n      selectInput(\n        \"g_dataset\",\n        \"Choose a dataset (preloaded):\",\n        choices = names(data_list)\n      ),\n      tabsetPanel(\n        id = \"graphics_tabs\",\n\n        # Histogram sub-tab\n        tabPanel(\n          \"Histogram\",\n          uiOutput(\"g_hist_var_ui\"),\n          numericInput(\n            \"g_breaks\",\n            \"Number of breaks (bins):\",\n            value = 10, min = 1, step = 1\n          ),\n          actionButton(\"insert_hist\", \"Insert hist() code into editor\")\n        ),\n\n        # Scatterplot sub-tab\n        tabPanel(\n          \"Scatterplot\",\n          uiOutput(\"g_scatter_ui\"),\n          actionButton(\"insert_scatter\", \"Insert scatterplot code into editor\")\n        )\n      )\n    )\n  })\n\n  # ---- Histogram variable selector ----\n  output$g_hist_var_ui <- renderUI({\n    req(input$g_dataset)\n\n    df <- data_list[[input$g_dataset]]\n\n    numeric_cols <- names(df)[sapply(df, is.numeric)]\n    if (length(numeric_cols) == 0) {\n      return(helpText(\"No numeric variables found in this dataset.\"))\n    }\n\n    selectInput(\n      \"g_hist_var\",\n      \"Choose a numeric variable for the histogram:\",\n      choices = numeric_cols\n    )\n  })\n\n  # ---- Scatterplot variable selectors (x and y) ----\n  output$g_scatter_ui <- renderUI({\n    req(input$g_dataset)\n\n    df <- data_list[[input$g_dataset]]\n\n    numeric_cols <- names(df)[sapply(df, is.numeric)]\n    if (length(numeric_cols) < 2) {\n      return(helpText(\"Need at least two numeric variables for a scatterplot.\"))\n    }\n\n    tagList(\n      selectInput(\n        \"g_scatter_x\",\n        \"X variable (horizontal axis):\",\n        choices = numeric_cols\n      ),\n      selectInput(\n        \"g_scatter_y\",\n        \"Y variable (vertical axis):\",\n        choices = numeric_cols,\n        selected = numeric_cols[min(2, length(numeric_cols))]\n      )\n    )\n  })\n\n  # ---- Insert hist() code into the editor ----\n  observeEvent(input$insert_hist, {\n    req(input$g_dataset, input$g_hist_var, input$g_breaks)\n\n    dataset_name <- input$g_dataset\n    line <- sprintf(\n      \"hist(%s$%s, breaks = %s)\",\n      dataset_name, input$g_hist_var, input$g_breaks\n    )\n\n    old_code <- input$code\n    if (is.null(old_code)) old_code <- \"\"\n\n    new_code <- if (nzchar(old_code)) {\n      paste(old_code, line, sep = \"\\n\")\n    } else {\n      line\n    }\n\n    updateTextAreaInput(session, \"code\", value = new_code)\n    current_fun(\"hist\")\n  })\n\n  # ---- Insert scatterplot code into the editor ----\n  observeEvent(input$insert_scatter, {\n    req(input$g_dataset, input$g_scatter_x, input$g_scatter_y)\n\n    dataset_name <- input$g_dataset\n    line <- sprintf(\n      \"plot(%s ~ %s, data = %s)\",\n      input$g_scatter_y,\n      input$g_scatter_x,\n      dataset_name\n    )\n\n    old_code <- input$code\n    if (is.null(old_code)) old_code <- \"\"\n\n    new_code <- if (nzchar(old_code)) {\n      paste(old_code, line, sep = \"\\n\")\n    } else {\n      line\n    }\n\n    updateTextAreaInput(session, \"code\", value = new_code)\n    current_fun(\"plot\")\n  })\n\n  # =====================\n  # Run code + outputs\n  # =====================\n\n  observeEvent(input$run, {\n    code_text <- input$code\n\n    # Clear previous outputs\n    output$text_out  <- renderText({ \"\" })\n    output$plot_out  <- renderPlot({ })\n\n    # Parse into multiple expressions\n    exprs <- try(parse(text = code_text), silent = TRUE)\n\n    if (inherits(exprs, \"try-error\")) {\n      output$text_out <- renderText({\n        paste(\"Parse error:\\n\", attr(exprs, \"condition\")$message)\n      })\n      return(NULL)\n    }\n\n    # Evaluate each expression, capture printed output\n    all_out <- character()\n\n    for (expr in exprs) {\n      this_out <- try(\n        {\n          res <- withVisible(eval(expr, envir = user_env))\n          capture.output(if (res$visible) print(res$value))\n        },\n        silent = TRUE\n      )\n\n      if (inherits(this_out, \"try-error\")) {\n        all_out <- c(\n          all_out,\n          paste(\"Error during evaluation:\",\n                attr(this_out, \"condition\")$message)\n        )\n      } else if (length(this_out) > 0) {\n        all_out <- c(all_out, this_out)\n      }\n    }\n\n    if (length(all_out) == 0) {\n      all_out <- \"[No printed output.]\"\n    }\n\n    output$text_out <- renderText({\n      paste(all_out, collapse = \"\\n\")\n    })\n\n    # Re-run code in a plotting context: any plotting calls will draw here\n    output$plot_out <- renderPlot({\n      eval(parse(text = code_text), envir = user_env)\n    })\n  })\n\n  # =====================\n  # Function help panel\n  # =====================\n\n  output$fun_help <- renderText({\n    fun <- current_fun()\n    if (is.null(fun)) {\n      return(\"Select a template (e.g. insert hist() or scatterplot code) to see help.\")\n    }\n\n    txt <- help_texts[[fun]]\n    if (is.null(txt)) {\n      return(paste(\"No help text defined for function:\", fun))\n    }\n\n    txt\n  })\n}\n\nshinyApp(ui, server)\n","type":"text"},{"name":"data/ex1.csv","content":"sale_id,employee_id,amount,date\n101,1,1500,2024-01-12\n102,3,2400,2024-01-13\n103,2,800,2024-01-14\n104,1,1100,2024-01-15\n105,5,3000,2024-01-16\n","type":"text"},{"name":"data/ex2.csv","content":"employee_id,name,department,salary\n1,Alice,Engineering,92000\n2,Bob,Marketing,68000\n3,Charlie,Engineering,99000\n4,Danielle,HR,72000\n5,Edward,Finance,84000\n","type":"text"}]
